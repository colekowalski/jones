{% set active_page = service -%}
{% extends "layout.html" %}
{% block head %}
<link rel=stylesheet href="{{ url_for('.static', filename='css/jsoneditor.css') }}">
<script>
var config = {{ config | tojson |safe }};

</script>
{% endblock %}
{% block body %}
<div class="modal hide" id="addChildModal">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">Ã—</button>
    <h3>Add child</h3>
    <h4></h4>
  </div>
  <div class="modal-body">
      <form>
          <fieldset>
              <label>Child</label>
              <input type="text">
          </fieldset>
      </form>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Close</a>
    <a id="modalSubmit" href="#" class="btn btn-primary">Save changes</a>
  </div>
</div>

<h2><a href="/service/{{ service }}">{{ service }}</a></h2>
<h3>/{% if env %}{{env}}{% endif %}</h3>
<div class="container-fluid">
    <div class="row-fluid">
        <div class="span4 well">
            <h4>Environments</h4>
            <table class="env-table table table-condensed table-striped">
                <tbody>
                {% for child, is_leaf in children %}
                    {% set ischild = (child[1:] == (env or '')) %}
                    {% set child_url = "/service/%s%s"|format(service, child) %}
                    {% if child %}
                        {% set child_pretty = child %}
                    {% else %}
                        {% set child_pretty = "/" %}
                    {% endif %}

                    <tr>
                        <td>
                            {% if ischild%}
                            <span><strong>{{ child_pretty }}</strong></span>
                            {% else %}
                            {# TODO: link span shoud go all the way to buttons. #}
                            <a href="{{ child_url }}"><span>{{ child_pretty }}</span></a>
                            {% endif %}
                            <span class="pull-right">
                                {% if is_leaf %}
                                <a class="btn del-env btn-mini" href="{{ child_url }}">Delete</a>
                                {% endif %}
                                <a class="btn add-env btn-mini" href="{{ child_url }}">Add Child</a>
                            </span>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <h4>Associations</h4>
            <div class="well" id="associations">
                <ul class="unstyled">
                    {% for ip in associations[env] %}
                    <li style="padding: 2px;">
                    <span>{{ ip }}</span>
                    <span class="pull-right">
                        <button class="btn btn-mini del-assoc" data-hostname="{{ ip }}"
                            data-loading-text="Deleting...">Delete</button>
                    </span>
                    </li>
                    {% else %}
                    <li>None</li>
                    {% endfor %}
                </ul>
                <div class="hide" id="add-assoc">
                    <input type="text" class="input-medium" id="hostname">
                    <button type="submit" class="btn btn-mini pull-right"
                        data-loading-text="Associating...">
                        Associate</button>
                </div>
                <button autocomplete="off" class="btn btn-mini">Add</button>
            </div>

            <h4>Inherited View</h4>
            <pre>{{ view | as_json(2) }}</pre>
        </div>

        <div class="span8">
            <div id="jsoneditor"></div>
            <div id="jsonformatter"></div>
            <button class="btn" id="update">Update</button>
        </div>
    </div>
</div>
{% endblock %}
{% block footer %}
<script>
    var version = {{ version }};
    var env = '{{ env }}';
    var service = '{{ service }}';
</script>
<script src="{{ url_for('.static', filename='js/json2.js') }}"></script>
<script src="{{ url_for('.static', filename='js/jsoneditor-min.js') }}"></script>
<script src="{{ url_for('.static', filename='js/service.js') }}"></script>

{% endblock %}
